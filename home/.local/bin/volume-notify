#!/bin/sh

set -e

if ponymix --sink is-muted; then
  MUTE=" (muted)"
  ICON=audio-volume-muted
else
  ICON=audio-volume-medium
fi

if ! ponymix --source is-muted; then
  MUTE2=" (mic: ON)"
fi

VOLUME=$(ponymix get-volume)
NOTIFICATION_LOCK=$XDG_RUNTIME_DIR/volume-notification.lock

find $XDG_RUNTIME_DIR/volume-notification.lock -mmin 2 -delete || true

notify-send.sh \
  --urgency=low \
  --replace-file=$NOTIFICATION_LOCK \
  --expire-time=1600 \
  --icon $ICON \
  --hint=int:transient:1 \
  --hint=int:value:$VOLUME \
  "Volume changed" \
  "$VOLUME% $MUTE $MUTE2"
