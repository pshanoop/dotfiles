#!/bin/sh
#
# Emails the results of the last run of a given script.
# See https://serverfault.com/a/814467/32648

if [ -z $1 ]; then
  echo No unit provided
  exit 1
fi

ts=$(systemctl --user show -p ActiveEnterTimestamp $1)
logs=$(journalctl --user -u $1 --since "$(echo $ts | awk '{print $2 $3}')")

/usr/bin/sendmail -t <<EOF
To: $EMAIL
From: systemd <$USER@$HOSTNAME>
Subject: $1
Content-Transfer-Encoding: 8bit
Content-Type: text/plain; charset=UTF-8

$logs
EOF
